package(default_visibility = ["//visibility:public"])

licenses(["notice"])  # The Universal Permissive License (UPL), Version 1.0

load("@io_kythe//tools/build_rules/lexyacc:lexyacc.bzl", "genlex", "genyacc")

filegroup(
    name = "license",
    srcs = ["LICENSE"],
)

genyacc(
    name = "parser",
    src = "src/parser/parser.yy",
    extra_outs = [
        "src/parser/stack.hh",
    ],
    header_out = "src/parser/parser.hh",
    source_out = "src/parser/parser.cc",
)

genlex(
    name = "scanner",
    src = "src/parser/scanner.ll",
    out = "scanner.yy.cc",
    includes = [":parser"],
)

cc_library(
    name = "souffle",
    srcs = [
        ":scanner",
        ":parser",
        "src/FunctorOps.cpp",
        "src/Global.cpp",
        "src/ast/Program.cpp",
        "src/ast/analysis/Aggregate.cpp",
        "src/ast/analysis/AuxArity.cpp",
        "src/ast/analysis/ClauseNormalisation.cpp",
        "src/ast/analysis/ComponentLookup.cpp",
        "src/ast/analysis/Functor.cpp",
        "src/ast/analysis/Ground.cpp",
        "src/ast/analysis/IOType.cpp",
        "src/ast/analysis/PrecedenceGraph.cpp",
        "src/ast/analysis/ProfileUse.cpp",
        "src/ast/analysis/RecursiveClauses.cpp",
        "src/ast/analysis/RedundantRelations.cpp",
        "src/ast/analysis/RelationDetailCache.cpp",
        "src/ast/analysis/RelationSchedule.cpp",
        "src/ast/analysis/SCCGraph.cpp",
        "src/ast/analysis/SumTypeBranches.cpp",
        "src/ast/analysis/TopologicallySortedSCCGraph.cpp",
        "src/ast/analysis/Type.cpp",
        "src/ast/analysis/TypeSystem.cpp",
        "src/ast/analysis/TypeEnvironment.cpp",
        "src/ast/transform/ADTtoRecords.cpp",
        "src/ast/transform/AddNullariesToAtomlessAggregates.cpp",
        "src/ast/transform/ComponentChecker.cpp",
        "src/ast/transform/ComponentInstantiation.cpp",
        "src/ast/transform/DebugReporter.cpp",
        "src/ast/transform/ExecutionPlanChecker.cpp",
        "src/ast/transform/FoldAnonymousRecords.cpp",
        "src/ast/transform/GroundedTermsChecker.cpp",
        "src/ast/transform/GroundWitnesses.cpp",
        "src/ast/transform/InlineRelations.cpp",
        "src/ast/transform/MagicSet.cpp",
        "src/ast/transform/MaterializeAggregationQueries.cpp",
        "src/ast/transform/MaterializeSingletonAggregation.cpp",
        "src/ast/transform/Meta.cpp",
        "src/ast/transform/MinimiseProgram.cpp",
        "src/ast/transform/NameUnnamedVariables.cpp",
        "src/ast/transform/NormaliseMultiResultFunctors.cpp",
        "src/ast/transform/PartitionBodyLiterals.cpp",
        "src/ast/transform/PolymorphicObjects.cpp",
        "src/ast/transform/PragmaChecker.cpp",
        "src/ast/transform/Provenance.cpp",
        "src/ast/transform/ReduceExistentials.cpp",
        "src/ast/transform/RemoveBooleanConstraints.cpp",
        "src/ast/transform/RemoveEmptyRelations.cpp",
        "src/ast/transform/RemoveRedundantRelations.cpp",
        "src/ast/transform/RemoveRedundantSums.cpp",
        "src/ast/transform/RemoveRelationCopies.cpp",
        "src/ast/transform/RemoveTypecasts.cpp",
        "src/ast/transform/ReorderLiterals.cpp",
        "src/ast/transform/ReplaceSingletonVariables.cpp",
        "src/ast/transform/ResolveAliases.cpp",
        "src/ast/transform/ResolveAnonymousRecordAliases.cpp",
        "src/ast/transform/SemanticChecker.cpp",
        "src/ast/transform/SimplifyAggregateTargetExpression.cpp",
        "src/ast/transform/Transformer.cpp",
        "src/ast/transform/TypeChecker.cpp",
        "src/ast/transform/UniqueAggregationVariables.cpp",
        "src/ast/utility/BindingStore.cpp",
        "src/ast/utility/SipsMetric.cpp",
        "src/ast/utility/Utils.cpp",
        "src/ast2ram/AstToRamTranslator.cpp",
        "src/ast2ram/ClauseTranslator.cpp",
        "src/ast2ram/ProvenanceClauseTranslator.cpp",
        "src/ast2ram/ValueIndex.cpp",
        "src/interpreter/Engine.cpp",
        "src/interpreter/Generator.cpp",
        "src/interpreter/BrieIndex.cpp",
        "src/interpreter/BTreeIndex.cpp",
        "src/interpreter/EqrelIndex.cpp",
        "src/interpreter/ProvenanceIndex.cpp",
        "src/parser/ParserDriver.cpp",
        "src/parser/ParserUtils.cpp",
        "src/parser/SrcLocation.cpp",
        "src/ram/analysis/Complexity.cpp",
        "src/ram/analysis/Index.cpp",
        "src/ram/analysis/Level.cpp",
        "src/ram/analysis/Relation.cpp",
        "src/ram/transform/ChoiceConversion.cpp",
        "src/ram/transform/CollapseFilters.cpp",
        "src/ram/transform/EliminateDuplicates.cpp",
        "src/ram/transform/ExpandFilter.cpp",
        "src/ram/transform/HoistAggregate.cpp",
        "src/ram/transform/HoistConditions.cpp",
        "src/ram/transform/IfConversion.cpp",
        "src/ram/transform/IndexedInequality.cpp",
        "src/ram/transform/MakeIndex.cpp",
        "src/ram/transform/Parallel.cpp",
        "src/ram/transform/ReorderConditions.cpp",
        "src/ram/transform/ReorderFilterBreak.cpp",
        "src/ram/transform/Transformer.cpp",
        "src/ram/transform/TupleId.cpp",
        "src/reports/DebugReport.cpp",
        "src/synthesiser/Synthesiser.cpp",
        "src/synthesiser/Relation.cpp",
    ],
    hdrs = [
        ":parser",
        # public headers
        "src/include/souffle/BinaryConstraintOps.h",
        "src/include/souffle/CompiledOptions.h",
        "src/include/souffle/CompiledSouffle.h",
        "src/include/souffle/RamTypes.h",
        "src/include/souffle/RecordTable.h",
        "src/include/souffle/SignalHandler.h",
        "src/include/souffle/SouffleInterface.h",
        "src/include/souffle/SymbolTable.h",
        "src/include/souffle/TypeAttribute.h",
        # datastructure headers
        "src/include/souffle/datastructure/BTree.h",
        "src/include/souffle/datastructure/Brie.h",
        "src/include/souffle/datastructure/EquivalenceRelation.h",
        "src/include/souffle/datastructure/LambdaBTree.h",
        "src/include/souffle/datastructure/PiggyList.h",
        "src/include/souffle/datastructure/Table.h",
        "src/include/souffle/datastructure/UnionFind.h",
        # io headers
        "src/include/souffle/io/IOSystem.h",
        "src/include/souffle/io/gzfstream.h",
        "src/include/souffle/io/ReadStream.h",
        "src/include/souffle/io/ReadStreamCSV.h",
        "src/include/souffle/io/ReadStreamJSON.h",
        "src/include/souffle/io/ReadStreamSQLite.h",
        "src/include/souffle/io/SerialisationStream.h",
        "src/include/souffle/io/WriteStreamSQLite.h",
        "src/include/souffle/io/WriteStream.h",
        "src/include/souffle/io/WriteStreamCSV.h",
        "src/include/souffle/io/WriteStreamJSON.h",
        # profile headers
        "src/include/souffle/profile/Cell.h",
        "src/include/souffle/profile/CellInterface.h",
        "src/include/souffle/profile/Cli.h",
        "src/include/souffle/profile/DataComparator.h",
        "src/include/souffle/profile/EventProcessor.h",
        "src/include/souffle/profile/HtmlGenerator.h",
        "src/include/souffle/profile/Iteration.h",
        "src/include/souffle/profile/Logger.h",
        "src/include/souffle/profile/OutputProcessor.h",
        "src/include/souffle/profile/ProfileDatabase.h",
        "src/include/souffle/profile/ProfileEvent.h",
        "src/include/souffle/profile/ProgramRun.h",
        "src/include/souffle/profile/Reader.h",
        "src/include/souffle/profile/Relation.h",
        "src/include/souffle/profile/Row.h",
        "src/include/souffle/profile/Rule.h",
        "src/include/souffle/profile/StringUtils.h",
        "src/include/souffle/profile/Table.h",
        "src/include/souffle/profile/Tui.h",
        "src/include/souffle/profile/UserInputReader.h",
        "src/include/souffle/profile/htmlCssChartist.h",
        "src/include/souffle/profile/htmlCssStyle.h",
        "src/include/souffle/profile/htmlJsChartistMin.h",
        "src/include/souffle/profile/htmlJsChartistPlugin.h",
        "src/include/souffle/profile/htmlJsMain.h",
        "src/include/souffle/profile/htmlJsTableSort.h",
        "src/include/souffle/profile/htmlJsUtil.h",
        "src/include/souffle/profile/htmlMain.h",
        # provenance headers
        "src/include/souffle/provenance/Explain.h",
        "src/include/souffle/provenance/ExplainProvenance.h",
        "src/include/souffle/provenance/ExplainProvenanceImpl.h",
        "src/include/souffle/provenance/ExplainTree.h",
        # utility headers
        "src/include/souffle/utility/CacheUtil.h",
        "src/include/souffle/utility/ContainerUtil.h",
        "src/include/souffle/utility/FileUtil.h",
        "src/include/souffle/utility/EvaluatorUtil.h",
        "src/include/souffle/utility/FunctionalUtil.h",
        "src/include/souffle/utility/MiscUtil.h",
        "src/include/souffle/utility/ParallelUtil.h",
        "src/include/souffle/utility/StreamUtil.h",
        "src/include/souffle/utility/StringUtil.h",
        "src/include/souffle/utility/json11.h",
        "src/include/souffle/utility/span.h",
        "src/include/souffle/utility/tinyformat.h",
        # other headers
        "src/AggregateOp.h",
        "src/FunctorOps.h",
        "src/Global.h",
        "src/GraphUtils.h",
        "src/LogStatement.h",
        "src/RelationTag.h",
        "src/ast/Aggregator.h",
        "src/ast/AlgebraicDataType.h",
        "src/ast/Argument.h",
        "src/ast/Atom.h",
        "src/ast/Attribute.h",
        "src/ast/BinaryConstraint.h",
        "src/ast/BooleanConstraint.h",
        "src/ast/BranchDeclaration.h",
        "src/ast/BranchInit.h",
        "src/ast/Clause.h",
        "src/ast/Component.h",
        "src/ast/ComponentInit.h",
        "src/ast/ComponentType.h",
        "src/ast/Constant.h",
        "src/ast/Constraint.h",
        "src/ast/Counter.h",
        "src/ast/ExecutionOrder.h",
        "src/ast/ExecutionPlan.h",
        "src/ast/Functor.h",
        "src/ast/FunctorDeclaration.h",
        "src/ast/Directive.h",
        "src/ast/IntrinsicFunctor.h",
        "src/ast/Literal.h",
        "src/ast/Negation.h",
        "src/ast/NilConstant.h",
        "src/ast/Node.h",
        "src/ast/NumericConstant.h",
        "src/ast/Pragma.h",
        "src/ast/Program.h",
        "src/ast/ProvenanceNegation.h",
        "src/ast/QualifiedName.h",
        "src/ast/RecordInit.h",
        "src/ast/RecordType.h",
        "src/ast/Relation.h",
        "src/ast/StringConstant.h",
        "src/ast/SubroutineArgument.h",
        "src/ast/SubsetType.h",
        "src/ast/Term.h",
        "src/ast/TranslationUnit.h",
        "src/ast/Type.h",
        "src/ast/TypeCast.h",
        "src/ast/UnionType.h",
        "src/ast/UnnamedVariable.h",
        "src/ast/UserDefinedFunctor.h",
        "src/ast/Variable.h",
        "src/ast/analysis/Aggregate.h",
        "src/ast/analysis/Analysis.h",
        "src/ast/analysis/AuxArity.h",
        "src/ast/analysis/ClauseNormalisation.h",
        "src/ast/analysis/ComponentLookup.h",
        "src/ast/analysis/Constraint.h",
        "src/ast/analysis/ConstraintSystem.h",
        "src/ast/analysis/Functor.h",
        "src/ast/analysis/Ground.h",
        "src/ast/analysis/IOType.h",
        "src/ast/analysis/PrecedenceGraph.h",
        "src/ast/analysis/ProfileUse.h",
        "src/ast/analysis/RecursiveClauses.h",
        "src/ast/analysis/RedundantRelations.h",
        "src/ast/analysis/RelationDetailCache.h",
        "src/ast/analysis/RelationSchedule.h",
        "src/ast/analysis/SCCGraph.h",
        "src/ast/analysis/SumTypeBranches.h",
        "src/ast/analysis/TopologicallySortedSCCGraph.h",
        "src/ast/analysis/Type.h",
        "src/ast/analysis/TypeSystem.h",
        "src/ast/analysis/TypeEnvironment.h",
        "src/ast/transform/ADTtoRecords.h",
        "src/ast/transform/AddNullariesToAtomlessAggregates.h",
        "src/ast/transform/ComponentChecker.h",
        "src/ast/transform/ComponentInstantiation.h",
        "src/ast/transform/Conditional.h",
        "src/ast/transform/DebugReporter.h",
        "src/ast/transform/ExecutionPlanChecker.h",
        "src/ast/transform/Fixpoint.h",
        "src/ast/transform/FoldAnonymousRecords.h",
        "src/ast/transform/GroundedTermsChecker.h",
        "src/ast/transform/GroundWitnesses.h",
        "src/ast/transform/IOAttributes.h",
        "src/ast/transform/IODefaults.h",
        "src/ast/transform/InlineRelations.h",
        "src/ast/transform/MagicSet.h",
        "src/ast/transform/MaterializeAggregationQueries.h",
        "src/ast/transform/MaterializeSingletonAggregation.h",
        "src/ast/transform/Meta.h",
        "src/ast/transform/MinimiseProgram.h",
        "src/ast/transform/NameUnnamedVariables.h",
        "src/ast/transform/NormaliseMultiResultFunctors.h",
        "src/ast/transform/Null.h",
        "src/ast/transform/PartitionBodyLiterals.h",
        "src/ast/transform/Pipeline.h",
        "src/ast/transform/PolymorphicObjects.h",
        "src/ast/transform/PragmaChecker.h",
        "src/ast/transform/Provenance.h",
        "src/ast/transform/ReduceExistentials.h",
        "src/ast/transform/RemoveBooleanConstraints.h",
        "src/ast/transform/RemoveEmptyRelations.h",
        "src/ast/transform/RemoveRedundantRelations.h",
        "src/ast/transform/RemoveRedundantSums.h",
        "src/ast/transform/RemoveRelationCopies.h",
        "src/ast/transform/RemoveTypecasts.h",
        "src/ast/transform/ReorderLiterals.h",
        "src/ast/transform/ReplaceSingletonVariables.h",
        "src/ast/transform/ResolveAliases.h",
        "src/ast/transform/ResolveAnonymousRecordAliases.h",
        "src/ast/transform/SemanticChecker.h",
        "src/ast/transform/SimplifyAggregateTargetExpression.h",
        "src/ast/transform/Transformer.h",
        "src/ast/transform/TypeChecker.h",
        "src/ast/transform/UniqueAggregationVariables.h",
        "src/ast/transform/While.h",
        "src/ast/utility/BindingStore.h",
        "src/ast/utility/LambdaNodeMapper.h",
        "src/ast/utility/NodeMapper.h",
        "src/ast/utility/SipsMetric.h",
        "src/ast/utility/Utils.h",
        "src/ast/utility/Visitor.h",
        "src/ast2ram/AstToRamTranslator.h",
        "src/ast2ram/ClauseTranslator.h",
        "src/ast2ram/Location.h",
        "src/ast2ram/ProvenanceClauseTranslator.h",
        "src/ast2ram/ValueIndex.h",
        "src/interpreter/Context.h",
        "src/interpreter/Engine.h",
        "src/interpreter/Generator.h",
        "src/interpreter/Index.h",
        "src/interpreter/Node.h",
        "src/interpreter/ViewContext.h",
        "src/interpreter/ProgInterface.h",
        "src/interpreter/Relation.h",
        "src/interpreter/Util.h",
        "src/parser/ParserDriver.h",
        "src/parser/ParserUtils.h",
        "src/parser/SrcLocation.h",
        "src/ram/AbstractAggregate.h",
        "src/ram/AbstractChoice.h",
        "src/ram/AbstractConditional.h",
        "src/ram/AbstractExistenceCheck.h",
        "src/ram/AbstractLog.h",
        "src/ram/AbstractOperator.h",
        "src/ram/AbstractParallel.h",
        "src/ram/Aggregate.h",
        "src/ram/AutoIncrement.h",
        "src/ram/BinRelationStatement.h",
        "src/ram/Break.h",
        "src/ram/Call.h",
        "src/ram/Choice.h",
        "src/ram/Clear.h",
        "src/ram/Condition.h",
        "src/ram/Conjunction.h",
        "src/ram/Constant.h",
        "src/ram/Constraint.h",
        "src/ram/DebugInfo.h",
        "src/ram/EmptinessCheck.h",
        "src/ram/ExistenceCheck.h",
        "src/ram/Exit.h",
        "src/ram/Expression.h",
        "src/ram/Extend.h",
        "src/ram/False.h",
        "src/ram/Filter.h",
        "src/ram/FloatConstant.h",
        "src/ram/IO.h",
        "src/ram/IndexAggregate.h",
        "src/ram/IndexChoice.h",
        "src/ram/IndexOperation.h",
        "src/ram/IndexScan.h",
        "src/ram/IntrinsicOperator.h",
        "src/ram/ListStatement.h",
        "src/ram/LogRelationTimer.h",
        "src/ram/LogSize.h",
        "src/ram/LogTimer.h",
        "src/ram/Loop.h",
        "src/ram/Negation.h",
        "src/ram/NestedIntrinsicOperator.h",
        "src/ram/NestedOperation.h",
        "src/ram/Node.h",
        "src/ram/Operation.h",
        "src/ram/PackRecord.h",
        "src/ram/Parallel.h",
        "src/ram/ParallelAggregate.h",
        "src/ram/ParallelChoice.h",
        "src/ram/ParallelIndexAggregate.h",
        "src/ram/ParallelIndexChoice.h",
        "src/ram/ParallelIndexScan.h",
        "src/ram/Program.h",
        "src/ram/Project.h",
        "src/ram/ProvenanceExistenceCheck.h",
        "src/ram/Query.h",
        "src/ram/Relation.h",
        "src/ram/RelationOperation.h",
        "src/ram/RelationStatement.h",
        "src/ram/RelationSize.h",
        "src/ram/ParallelScan.h",
        "src/ram/Scan.h",
        "src/ram/Sequence.h",
        "src/ram/SignedConstant.h",
        "src/ram/Statement.h",
        "src/ram/SubroutineArgument.h",
        "src/ram/SubroutineReturn.h",
        "src/ram/Swap.h",
        "src/ram/TranslationUnit.h",
        "src/ram/True.h",
        "src/ram/TupleElement.h",
        "src/ram/TupleOperation.h",
        "src/ram/UndefValue.h",
        "src/ram/UnpackRecord.h",
        "src/ram/UnsignedConstant.h",
        "src/ram/UserDefinedOperator.h",
        "src/ram/analysis/Analysis.h",
        "src/ram/analysis/Complexity.h",
        "src/ram/analysis/Index.h",
        "src/ram/analysis/Level.h",
        "src/ram/analysis/Relation.h",
        "src/ram/transform/ChoiceConversion.h",
        "src/ram/transform/CollapseFilters.h",
        "src/ram/transform/Conditional.h",
        "src/ram/transform/EliminateDuplicates.h",
        "src/ram/transform/ExpandFilter.h",
        "src/ram/transform/HoistAggregate.h",
        "src/ram/transform/HoistConditions.h",
        "src/ram/transform/IfConversion.h",
        "src/ram/transform/IndexedInequality.h",
        "src/ram/transform/Loop.h",
        "src/ram/transform/MakeIndex.h",
        "src/ram/transform/Meta.h",
        "src/ram/transform/Parallel.h",
        "src/ram/transform/ReorderConditions.h",
        "src/ram/transform/ReorderFilterBreak.h",
        "src/ram/transform/ReportIndex.h",
        "src/ram/transform/Sequence.h",
        "src/ram/transform/Transformer.h",
        "src/ram/transform/TupleId.h",
        "src/ram/utility/LambdaNodeMapper.h",
        "src/ram/utility/NodeMapper.h",
        "src/ram/utility/Utils.h",
        "src/ram/utility/Visitor.h",
        "src/reports/DebugReport.h",
        "src/reports/ErrorReport.h",
        "src/synthesiser/Synthesiser.h",
        "src/synthesiser/Relation.h",
    ],
    includes = [
        "src",
        "src/include",
    ],
    deps = [
        "@org_sourceware_libffi//:libffi",
    ],
)
